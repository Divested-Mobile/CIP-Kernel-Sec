description: privileged process entering userns can be ptraced by userns owner
references:
- https://bugs.launchpad.net/ubuntu/+source/lxd/+bug/1527374
- https://lkml.org/lkml/2015/12/25/71
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-8709
- https://lkml.org/lkml/2015/12/12/259
- http://www.ubuntu.com/usn/usn-2847-1
- http://www.ubuntu.com/usn/usn-2848-1
- http://www.ubuntu.com/usn/usn-2849-1
- http://www.ubuntu.com/usn/usn-2850-1
- http://www.ubuntu.com/usn/usn-2851-1
- http://www.ubuntu.com/usn/usn-2852-1
- http://www.ubuntu.com/usn/usn-2853-1
- http://www.ubuntu.com/usn/usn-2854-1
- http://www.openwall.com/lists/oss-security/2015/12/31/5
- https://launchpad.net/bugs/1527374
- https://usn.ubuntu.com/usn/usn-2847-1
- https://usn.ubuntu.com/usn/usn-2848-1
- https://usn.ubuntu.com/usn/usn-2849-1
- https://usn.ubuntu.com/usn/usn-2850-1
- https://usn.ubuntu.com/usn/usn-2851-1
- https://usn.ubuntu.com/usn/usn-2852-1
- https://usn.ubuntu.com/usn/usn-2853-1
- https://usn.ubuntu.com/usn/usn-2854-1
- https://ubuntu.com/security/notices/USN-2847-1
- https://ubuntu.com/security/notices/USN-2848-1
- https://ubuntu.com/security/notices/USN-2849-1
- https://ubuntu.com/security/notices/USN-2850-1
- https://ubuntu.com/security/notices/USN-2851-1
- https://ubuntu.com/security/notices/USN-2852-1
- https://ubuntu.com/security/notices/USN-2853-1
- https://ubuntu.com/security/notices/USN-2854-1
- https://www.cve.org/CVERecord?id=CVE-2015-8709
comments:
  debian/bwh: |-
    CVE requested at http://www.openwall.com/lists/oss-security/2015/12/17/12
    This was initially rejected as an upstream kernel bug, but I believe it
    was eventually fixed upstream as noted below.
    Dependencies:
    3dfb7d8cdbc7 security: let security modules use PTRACE_MODE_* with bitmasks
    caaee6234d05 ptrace: use fsuid, fsgid, effective creds for fs access checks
    Related:
    64b875f7ac8a ptrace: Capture the ptracer's creds not PT_PTRACE_CAP
    84d77d3f06e7 ptrace: Don't allow accessing an undumpable mm
    f84df2a6f268 exec: Ensure mm->user_ns contains the execed files
    613cc2b6f272 fs: exec: apply CLOEXEC before changing dumpable task flags
  ubuntu/sbeattie: |-
    published fix has been reverted and replaced by upstream
      commit. Published kernels are not vulnerable to this, the status is
      tracking the state of the replaced commit coming through the trees.
reporters:
- Jann Horn
introduced-by:
  mainline: [22d917d80e842829d0ca0a561967d728eb1d6303]
fixed-by:
  aosp/3.18: [78767518df7222490c539c111c2244977f94e967]
  cip/4.4: [03eed7afbc09e061f66b448daf7863174c3dc3f3]
  cip/4.4-rt: [03eed7afbc09e061f66b448daf7863174c3dc3f3]
  cip/4.4-st: [03eed7afbc09e061f66b448daf7863174c3dc3f3]
  debian/buster-security: ['patch:debian/4.3.3-3:bugfix/all/ptrace-being-capable-wrt-a-process-requires-mapped-uids-gids.patch']
  debian/jessie-security: ['patch:debian/3.16.7-ckt20-1+deb8u2:bugfix/all/ptrace-being-capable-wrt-a-process-requires-mapped-uids-gids.patch']
  debian/stretch-security: ['patch:debian/4.3.3-3:bugfix/all/ptrace-being-capable-wrt-a-process-requires-mapped-uids-gids.patch']
  mainline: [bfedb589252c01fa505ac9f6f2a3d5d68d707ef4]
  stable/3.16: [d5b3e840dbf6dd2c0f30b5982b6f5ecd49e46b12]
  stable/4.4: [03eed7afbc09e061f66b448daf7863174c3dc3f3]
  stable/4.8: [e45692fa1aea06676449b63ef3c2b6e1e72b7578]
  stable/4.9: [694a95fa6dae4991f16cda333d897ea063021fed]
  ubuntu/xenial: [e3f2460028485b1ab46a454820790056cc7a25c2, de8a1b67702d3d7e348951ca716853abb5ff0214]
