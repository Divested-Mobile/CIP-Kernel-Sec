description: |
  Race condition in mm/gup.c in the Linux kernel 2.x through 4.x before 4.8.3
  allows local users to gain privileges by leveraging incorrect handling of a
  copy-on-write (COW) feature to write to a read-only memory mapping, as
  exploited in the wild in October 2016, aka "Dirty COW."
advisory: |
  It was discovered that a race condition in the memory management
  code can be used for local privilege escalation.  This does not
  affect kernels built with PREEMPT_RT enabled.
references:
- https://github.com/dirtycow/dirtycow.github.io/wiki/VulnerabilityDetails
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-5195
- http://www.ubuntu.com/usn/usn-3107-1
- http://www.ubuntu.com/usn/usn-3106-4
- http://www.ubuntu.com/usn/usn-3106-3
- http://www.ubuntu.com/usn/usn-3106-2
- http://www.ubuntu.com/usn/usn-3106-1
- http://www.ubuntu.com/usn/usn-3105-2
- http://www.ubuntu.com/usn/usn-3105-1
- http://www.ubuntu.com/usn/usn-3104-1
- http://www.ubuntu.com/usn/usn-3107-2
- http://www.ubuntu.com/usn/usn-3104-2
- https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1633547
- https://usn.ubuntu.com/usn/usn-3107-1
- https://usn.ubuntu.com/usn/usn-3106-4
- https://usn.ubuntu.com/usn/usn-3106-3
- https://usn.ubuntu.com/usn/usn-3106-2
- https://usn.ubuntu.com/usn/usn-3106-1
- https://usn.ubuntu.com/usn/usn-3105-2
- https://usn.ubuntu.com/usn/usn-3105-1
- https://usn.ubuntu.com/usn/usn-3104-1
- https://usn.ubuntu.com/usn/usn-3107-2
- https://usn.ubuntu.com/usn/usn-3104-2
aliases:
- Dirty COW
comments:
  bwh: |
    The __get_user_pages() function implements copy-on-write for
    mappings where this is enabled.  It may be invoked via the ptrace
    API, which is allowed to modify (through copy-on-write) pages that
    are not normally writable, so following a copy-on-write it will
    make the target PTE writable without the normal write permission
    check.  However, there is a race condition that means it is
    possible for a process to make the target PTE point to a shared
    read-only page before the permission change.  This can be used to
    modify the cached version of any readable file, for example to
    inject code into an executable.
  ubuntu/jdstrand: |-
    android kernels (flo, goldfish, grouper, maguro, mako and manta) are
     not supported on the Ubuntu Touch 14.10 and earlier preview kernels
    linux-lts-saucy no longer receives official support
    linux-lts-quantal no longer receives official support
reporters:
- Phil Oester <kernel@linuxace.com>
embargo-end: 2016-10-20T00:00:00+00:00
introduced-by:
  mainline: [f33ea7f404e592e4563b12101b7a4d17da6558d7, 0a27a14a62921b438bb6f33772690d345a089be6]
fixed-by:
  cip/4.4: [1294d355881cc5c3421d24fee512f16974addb6c]
  cip/4.4-rt: [1294d355881cc5c3421d24fee512f16974addb6c]
  debian/buster-security: ['patch:debian/4.7.8-1:bugfix/all/mm-remove-gup_flags-FOLL_WRITE-games-from-__get_user.patch']
  debian/jessie-security: ['patch:debian/3.16.36-1+deb8u2:bugfix/all/mm-remove-gup_flags-FOLL_WRITE-games-from-__get_user.patch']
  debian/stretch-security: ['patch:debian/4.7.8-1:bugfix/all/mm-remove-gup_flags-FOLL_WRITE-games-from-__get_user.patch']
  mainline: [19be0eaffa3ac7d8eb6784ad9bdbc7d67ed8e619]
  stable/3.10: [9691eac5593ff1e2f82391ad327f21d90322aec1]
  stable/3.12: [f949fcd7414197b8e04b07c480d36bc39332ff7b]
  stable/3.16: [2649c26fdeb99f1c104c387ae63fd72e119c2b96]
  stable/3.18: [e45a502bdeae5a075257c4f061d1ff4ff0821354]
  stable/3.2: [243f858d7045b710a31c377112578387ead4dde1]
  stable/3.4: [1c8544a93151329be95f702f6f4029f860b77ee7]
  stable/4.1: [c865f98df72112a3997b219bf711bc46c1e90706]
  stable/4.4: [1294d355881cc5c3421d24fee512f16974addb6c]
  stable/4.7: [30712aff8011b67be3e7e31ea079cfc9d3effef4]
  stable/4.8: [89eeba1594ac641a30b91942961e80fae978f839]
  ubuntu/xenial: [b56d2a75e1daae6ff6eedfb732eadf3c13df6090]
fix-depends-on:
  abf09bed3cceadd809f0356065c2ada6cee90d4a: |
    This made PTE dirty bits available on s390 (they were already
    available on all other architectures).  For earlier kernel
    versions, the fix needs to use a different test for whether
    the target PTE is still un-shared.
tests:
- gupforce
