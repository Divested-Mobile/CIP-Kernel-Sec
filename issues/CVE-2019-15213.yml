description: 'media: dvb: usb: use after free in dvb_usb_device_exit'
references:
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15213
- https://cdn.kernel.org/pub/linux/kernel/v5.x/ChangeLog-5.2.3
- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6cf97230cd5f36b7665099083272595c55d72be7
- https://syzkaller.appspot.com/bug?id=a53c9c9dd2981bfdbfbcbc1ddbd35595eda8bced
- https://lore.kernel.org/linux-media/fe983331d14442a96db3f71066ca0488a8921840.camel@decadent.org.uk/
- https://bugzilla.kernel.org/show_bug.cgi?id=204597
- https://lore.kernel.org/linux-media/fe983331d14442a96db3f71066ca0488a8921840.camel%40decadent.org.uk/
- https://lore.kernel.org/linux-media/20190822104147.4420-1-vasilyev@ispras.ru/
- https://bugzilla.suse.com/show_bug.cgi?id=1146544
- https://www.cve.org/CVERecord?id=CVE-2019-15213
comments:
  debian/bwh: |-
    This is supposed to be fixed by commit 6cf97230cd5f "media: dvb:
    usb: fix use after free in dvb_usb_device_exit", but that won't fix
    the syzkaller report it claims to.  The KASAN output shows an 8-byte
    access to memory that was allocated in dw2102_probe(), apparently by
    the statement "s421 = kmemdup(...)".  But it was also freed by
    dw2102_probe(), so d->desc was already a dangling pointer before
    dvb_usb_device_exit() was called.
    The name strings seem to be static data that are only freed when
    the module containing them is unloaded.  Which dvb_usb_device_exit()
    doesn't do.
    Introduced in 4.19 by commit 299c7007e936 "media: dw2102: Fix
    memleak on sequence of probes".
  ubuntu/sbeattie: unfixed upstream as of 2022-01-27
  ubuntu/tyhicks: |-
    Setting priority to low since this issue requires a malicious USB
     device to be inserted into the system
    Ben Hutchings noticed that commit 6cf97230cd5f ("media: dvb: usb: fix
     use after free in dvb_usb_device_exit"), which is mentioned in the CVE
     references for this issue, likely doesn't fix the problem. See the lore
     reference above for details. I think Ben is correct and have adjusted our
     break-fix metadata to use the break commit that he pointed out.
introduced-by:
  mainline: [299c7007e93645067e1d2743f4e50156de78c4ff]
  stable/4.14: [6b7c7186c210df8fd3f2bd6f074715f4ac07979b]
  ubuntu/bionic: [6ea67c430dc703eb4eef5e73a200c492cc9fd01f]
fixed-by:
  cip/4.19: [94f2b518a7882f562537796b77e3ce6a6461236d]
  cip/4.19-rt: [94f2b518a7882f562537796b77e3ce6a6461236d]
  cip/4.4: [94f2b518a7882f562537796b77e3ce6a6461236d]
  cip/4.4-rt: [94f2b518a7882f562537796b77e3ce6a6461236d]
  cip/4.4-st: [94f2b518a7882f562537796b77e3ce6a6461236d]
  mainline: [6cf97230cd5f36b7665099083272595c55d72be7]
  stable/4.14: [6cf97230cd5f36b7665099083272595c55d72be7]
  stable/4.19: [94f2b518a7882f562537796b77e3ce6a6461236d]
  stable/4.4: [7e95655b54ca06487eb95595f3b95ad829b81dc8]
  stable/4.9: [1d2e6bd4b64da75e6dba06fc9e3977c6413632b1]
  ubuntu/bionic: [4d211dcbc47c2a13d6a01f02aec81e18356533e3]
  ubuntu/xenial: [180be3ae9661464386ac3f1a6ba01ba9b182c921]
ignore:
  cip/4.19: No member enables dw2102
  cip/4.19-rt: No member enables dw2102
  cip/4.4: No member enables dw2102
  cip/4.4-rt: No member enables dw2102
  cip/4.4-st: No member enables dw2102
