description: |-
  In the Linux kernel, a certain net/ipv4/tcp_output.c change, which was
  properly incorporated into 4.16.12, was incorrectly backported to the
  earlier longterm kernels, introducing a new vulnerability that was
  potentially more severe than the issue that was intended to be fixed by
  backporting. Specifically, by adding to a write queue between disconnection
  and re-connection, a local attacker can trigger multiple use-after-free
  conditions. This can result in a kernel crash, or potentially in privilege
  escalation. NOTE: this affects (for example) Linux distributions that use
  4.9.x longterm kernels before 4.9.190 or 4.14.x longterm kernels before
  4.14.139.
references:
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15239
- https://pulsesecurity.co.nz/advisories/linux-kernel-4.9-tcpsocketsuaf
- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=7f582b248d0a86bae5788c548d7bb5bca6f7691a
- https://lore.kernel.org/stable/41a61a2f87691d2bc839f26cdfe6f5ff2f51e472.camel@decadent.org.uk/
- https://salsa.debian.org/kernel-team/kernel-sec/blob/f6273af2d956a87296b6b60379d0a186c9be4bbc/active/CVE-2019-15239
- https://www.debian.org/security/2019/dsa-4497
- https://lore.kernel.org/stable/20190813115317.6cgml2mckd3c6u7z@decadent.org.uk/
- https://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux/+git/xenial/commit/?id=edff0f7fc52aa3fba1141755ae5aa008c51eb518
- https://www.cve.org/CVERecord?id=CVE-2019-15239
comments:
  debian/bwh: |-
    Introduced by backports of commit 7f582b248d0a
    "tcp: purge write queue in tcp_connect_init()" to stable.
    Upstream avoided this issue due to the earlier commit
    75c119afe14f "tcp: implement rb-tree based retransmit queue".
  debian/carnil: |-
    As pointed out by Ben, in https://lore.kernel.org/stable/41a61a2f87691d2bc839f26cdfe6f5ff2f51e472.camel@decadent.org.uk/
    the issue got already fixed by dbbf2d1e4077 ("tcp: reset
    sk_send_head in tcp_write_queue_purge") in 4.14.32, which got
    backported to 4.4.187 and 4.9.187.
  ubuntu/sbeattie: |-
    This vulnerability was introduced when
      7f582b248d0a86bae5788c548d7bb5bca6f7691a was incorrectly backported to
      stable kernels; the upstream kernel was prevented from being vulnerable
      because 75c119afe14f74b4dd967d75ed9f57ab6c0ef045 had landed prior to it.
      Thus, for the upstream kernel, the fix for the issue predates the
      commit that introduced the issue.
    link to xenial kernel git commit above demonstrates the fix
      that landed to address backport kernels.
introduced-by:
  cip/4.4: [5bbe138a250e795b32f29fc91af88c69851a12d3]
  cip/4.4-rt: [5bbe138a250e795b32f29fc91af88c69851a12d3]
  mainline: never
  stable/3.16: [0da162e05f65a8073ef1dc3c7598b82a9b9caa70]
  stable/3.18: [85611642047443ea8567f5cccc4c282fedde11b6]
  stable/4.14: [c89d534301a028125432e7d9a39edb08cfd90480]
  stable/4.4: [5bbe138a250e795b32f29fc91af88c69851a12d3]
  stable/4.9: [74a4c09d4b05c67ed6bd6aed088a5552f4f64aaa]
fixed-by:
  cip/4.4: [8f0b77b71f3fec09f86f80cd98c36a1a35109499]
  cip/4.4-rt: [8f0b77b71f3fec09f86f80cd98c36a1a35109499]
  debian/jessie-security: ['patch:debian/3.16.72-1:bugfix/all/tcp-clear-sk_send_head-after-purging-the-write-queue.patch']
  debian/stretch-security: ['patch:debian/4.9.168-1+deb9u5:bugfix/all/tcp-clear-sk_send_head-after-purging-the-write-queue.patch']
  stable/3.16: [3157fbc900bdb366b2186e5a6e506cc5e4697cf0]
  stable/4.14: [dbbf2d1e4077bab0c65ece2765d3fc69cf7d610f]
  stable/4.4: [8f0b77b71f3fec09f86f80cd98c36a1a35109499]
  stable/4.9: [704533394e488a109fe46ab3693315376c3824d5]
  ubuntu/xenial: ['version:4.4.0-165.193']
