description: 'ext4: crafted image causes heap OOB write in ext4_xattr_set_entry'
references:
- https://github.com/bobfuzzer/CVE/tree/master/CVE-2019-19319
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-19319
- https://bugzilla.suse.com/show_bug.cgi?id=1158021
- https://usn.ubuntu.com/usn/usn-4391-1
- https://ubuntu.com/security/notices/USN-4391-1
- https://www.cve.org/CVERecord?id=CVE-2019-19319
comments:
  debian/bwh: |-
    SUSE has backported the fix as far as 3.12. It turns out that
    they backported *part* of commit dec214d00e0d to fix CVE-2018-1094
    which I thought didn't affect older branches. See
    <https://github.com/openSUSE/kernel-source/blob/SLE12-SP4/patches.suse/ext4-make-metadata-csum-checks-safer.patch>
    and
    <https://github.com/openSUSE/kernel-source/blob/SLE12-SP4/patches.suse/ext4-protect-journal-inode-s-blocks-using-block_vali.patch>.
    So we should probably apply both of these to 3.16 and 4.9.
    Note the follow-up fixes: commits fbbbbd2f28aec, 170417c8c7bb,
    0a944e8a6c66, af133ade9a40.
  debian/carnil: |-
    Introduced in dec214d00e0d ("ext4: xattr inode deduplication")
    in 4.13-rc1? Cf.
    https://bugzilla.suse.com/show_bug.cgi?id=1158021#c2
  ubuntu/sbeattie: |-
    it's asserted by Jan Kara in the suse bug below that
     345c0dbf3a30 (plus related commits) addresses the issue
  ubuntu/tyhicks: |-
    Exploiting this vulnerability requires a crafted filesystem image to
     be mounted
  wens: |-
    Besides 345c0dbf3a30 ("ext4: protect journal inode's blocks using
    block_validity"), additional fixes are required, as seen in a regression
    report [1] against the first backport of the patch. The additional ones
    seem to be the following, found with fixes tags.

      fbbbbd2f28ae ext4: unsigned int compared against zero
      170417c8c7bb ext4: fix block validity checks for journal inodes using indirect blocks
      0a944e8a6c66 ext4: don't perform block validity checks on the journal inode

    Commit af133ade9a40 ("ext4: add cond_resched() to ext4_protect_reserved_inode")
    listed above as a follow-up fix is also listed in CVE-2020-8992.

    [1] https://lkml.org/lkml/2019/5/22/17
introduced-by:
  mainline: [dec214d00e0d78a08b947d7dccdfdb84407a9f4d]
fixed-by:
  cip/4.19: [2fd4629de51974002f4e9cf1a35a1926dd6c9d99, ff69322509bb3f48c4e08cc3bef7c414519a7862,
    292666d2d868f30a55f6d5f15c5a1a16a38a99c5, 97fbf573460e56ddf172614f70cdfa2af03b20ea]
  cip/4.19-rt: [2fd4629de51974002f4e9cf1a35a1926dd6c9d99, ff69322509bb3f48c4e08cc3bef7c414519a7862,
    292666d2d868f30a55f6d5f15c5a1a16a38a99c5, 97fbf573460e56ddf172614f70cdfa2af03b20ea]
  cip/4.4: [7eff961ca9f364be255d279346517ba0158ec8e3, 2cdaf6782b517932eaee74c199b79ffc4674838c,
    474db4dfd942780673538b4b032dccb6b3bcfbd2, 571fa68cacdf5fa70a6fdb71bda051f822d3cfb6]
  cip/4.4-rt: [7eff961ca9f364be255d279346517ba0158ec8e3, 2cdaf6782b517932eaee74c199b79ffc4674838c,
    474db4dfd942780673538b4b032dccb6b3bcfbd2, 571fa68cacdf5fa70a6fdb71bda051f822d3cfb6]
  cip/4.4-st: [7eff961ca9f364be255d279346517ba0158ec8e3, 2cdaf6782b517932eaee74c199b79ffc4674838c,
    474db4dfd942780673538b4b032dccb6b3bcfbd2, 571fa68cacdf5fa70a6fdb71bda051f822d3cfb6]
  debian/buster-security: ['version:debian/4.19.87-1']
  debian/jessie-security: ['patch:debian/3.16.84-1:bugfix/all/ext4-protect-journal-inode-s-blocks-using-block_vali.patch']
  debian/stretch-security: ['patch:debian/4.9.210-1+deb9u1:bugfix/all/ext4-protect-journal-inode-s-blocks-using-block_vali.patch']
  mainline: [345c0dbf3a30872d9b204db96b5857cd00808cae, fbbbbd2f28aec991f3fbc248df211550fbdfd58c,
    170417c8c7bb2cbbdd949bf5c443c0c8f24a203b, 0a944e8a6c66ca04c7afbaa17e22bf208a8b37f0]
  openela/4.14: [795762468125a6412c089651e74f780bee154118, 22dec5f46b404668d3bebe599ee4cff42501f7e7,
    ea8f7a3dfd66f9ad1f65b47159ff38d8c278e5d7, fc3293a80acc469fbabc91bfbf2e65dc84377dc7]
  stable/3.16: [51890201da4d654f6ca131bc45a0e892bb10de1d, 310dac05e090433b1de043eff9d0b0c389ba843f,
    a8a1d01018f66c5cc3cb2a4c194e55edcf0e50ec, 71bfaf9e30125ec5b408fd328e412abf3b23214d]
  stable/4.14: [795762468125a6412c089651e74f780bee154118, 22dec5f46b404668d3bebe599ee4cff42501f7e7,
    ea8f7a3dfd66f9ad1f65b47159ff38d8c278e5d7, fc3293a80acc469fbabc91bfbf2e65dc84377dc7]
  stable/4.19: [2fd4629de51974002f4e9cf1a35a1926dd6c9d99, ff69322509bb3f48c4e08cc3bef7c414519a7862,
    292666d2d868f30a55f6d5f15c5a1a16a38a99c5, 97fbf573460e56ddf172614f70cdfa2af03b20ea]
  stable/4.4: [7eff961ca9f364be255d279346517ba0158ec8e3, 2cdaf6782b517932eaee74c199b79ffc4674838c,
    474db4dfd942780673538b4b032dccb6b3bcfbd2, 571fa68cacdf5fa70a6fdb71bda051f822d3cfb6]
  stable/4.9: [a9855260fe8d8680bf8c4f0d8303b696c861e99b, 5a905c2d2cf2b11676d1c5e9a0a035c1369ae9df,
    12140f9b8f5aa316b2888b2c876d3b59a7dac524, 2130aae807893cff163404bf6f6f6a4906dd14a1]
  ubuntu/bionic: [987a1f2ee0447efe9191d96396eda32276ec2e11, 422aff45715587d7ede50694daf55a38125bb1dd,
    58357591407e59591abb3213cda7728ff14631fa, b94ce99f99d5956f3bcf5614b45a98d63a9c0b3d]
  ubuntu/focal: ['version:5.4.0-9.12']
  ubuntu/xenial: [0da6fcada077a7b47258ea299abb4343d839fd90, cdcc3f2475aecd219a9f066df4537c4e499d0c72,
    82c3566925922c84f4e7a7f0f3888aacb7d350ae, 188181495baa5f2d3ea2b82c5ccbe45f61ca5ed2]
tests:
- CVE-2019-19319
