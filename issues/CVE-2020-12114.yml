description: 'fs/namespace.c: fix mountpoint reference counter race'
references:
- https://www.openwall.com/lists/oss-security/2020/05/04/2
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-12114
- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=4edbe133f851c9e3a2f2a1db367e826b01e72594
comments:
  Debian-carnil: |-
    According to the commit message this race condition between
    threads updating mountpoint reference counter affects longterm
    releases 4.4.220, 4.9.220, 4.14.177 and 4.19.118. and got fixed
    in 4.4.221, 4.9.221, 4.14.178 and 4.19.119. This was fixed
    upstream along with 4edbe133f851 ("make struct mountpoint bear
    the dentry reference to mountpoint, not struct mount") in
    5.3-rc1. Similar issue (but not covered by the CVE) is adressed
    in b0d3869ce9ee ("propagate_one(): mnt_set_mountpoint() needs
    mount_lock"). This was adressed as well in 4.4.221, 4.9.221,
    4.14.178 and 4.19.120. Additionally in 5.4.37 and 5.6.9.
  wens: |-
    For mainline, it seems 2763d1191231 ("get rid of detach_mnt()") is
    the commit that actually fixes things by moving the reference counter
    update into the locked scope.
reporters:
- Piotr Krysiuk
introduced-by:
  mainline: [84d17192d2afd52aeba88c71ae4959a015f56a38]
fixed-by:
  linux-3.16.y: [172f22d527862eb5aa9dd767826f5d68562943db]
  linux-4.14.y: [e21c8c03af20932c15d8b1d3bb9cbad9607a6eab]
  linux-4.19.y: [f511dc75d22e0c000fc70b54f670c2c17f5fba9a]
  linux-4.4.y: [83354adbd7a967230bd23a547c5b695567ddba2c]
  linux-4.9.y: [91e997939dda1a866f23ddfb043dcd4a3ff57524]
  mainline: [2763d11912317a12318135ca03e592bb6df65624]
