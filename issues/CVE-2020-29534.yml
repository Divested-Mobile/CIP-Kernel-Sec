description: |-
  An issue was discovered in the Linux kernel before 5.9.3. io_uring takes a
  non-refcounted reference to the files_struct of the process that submitted
  a request, causing execve() to incorrectly optimize unshare_fd(), aka
  CID-0f2122045b94.
references:
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-29534
- https://bugs.chromium.org/p/project-zero/issues/detail?id=2089
- https://git.kernel.org/linus/0f2122045b946241a9e549c2a76cea54fa58a7ff
- https://cdn.kernel.org/pub/linux/kernel/v5.x/ChangeLog-5.9.3
- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0f2122045b946241a9e549c2a76cea54fa58a7ff
- https://usn.ubuntu.com/usn/usn-4678-1
- https://ubuntu.com/security/notices/USN-4678-1
- https://www.cve.org/CVERecord?id=CVE-2020-29534
comments:
  ubuntu/sbeattie: |-
    likely also want f26c08b444df833b19c00838a530d93963ce9cd0 and
      ca6484cd308a671811bf39f3119e81966eb476e3
    introducing commit may be newer than
      2b188cc1bb857a9d4701ae59aa7768b5124e262e
  wens: |-
    Based on the Project Zero description, the culprit could be
    05f3fb3c5397 ("io_uring: avoid ring quiesce for fixed file set unregister and update").
    Based on surrounding code of the fix, the culprit could be
    b5dba59e0cf7 ("io_uring: add support for IORING_OP_CLOSE")
    Both commits were added in v5.6-rc1. OTOH the fix is tagged for stable v5.5+.
    The fix is part of v5.10-rc1.
reporters:
- Jann Horn
introduced-by:
  mainline: [05f3fb3c5397524feae2e73ee8e150a9090a7da2]
fixed-by:
  mainline: [0f2122045b946241a9e549c2a76cea54fa58a7ff]
  stable/5.9: [adb6bf5ea1ac14bc78bdd5fc0cbe232d97870169]
  ubuntu/focal: ['version:5.4.0-9.12']
  ubuntu/groovy: [3522ddc83cd60c542a803f3a3d331baf00408858]
