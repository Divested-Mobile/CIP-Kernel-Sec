description: locking issue in net/sched module
references:
- https://source.android.com/security/bulletin/pixel/2022-03-01
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-39713
- https://android.googlesource.com/kernel/common/+/e368fdb61d8e7
- https://android.googlesource.com/kernel/common/+/9d7e82cec35c0
- https://android.googlesource.com/kernel/common/+/3a7d0d07a3867
- https://android.googlesource.com/kernel/common/+/86bd446b5cebd
- https://android.googlesource.com/kernel/common/+/6f99528e97977
- https://syzkaller.appspot.com/bug?id=d7e411c5472dd5da33d8cc921ccadc747743a568
- https://ubuntu.com/security/notices/USN-5413-1
- https://ubuntu.com/security/notices/USN-5484-1
- https://www.cve.org/CVERecord?id=CVE-2021-39713
comments:
  debian/bwh: |-
    This is puzzling.  The UAF occurs in net/sched/cls_api.c where
    all access to the qdisc state seems to be protected by the RTNL
    already, so it's not clear why switching to RCU protection would
    help.  The syzkaller-generated reproducer also didn't work for me.
    So I can't tell whether 4.9 might also be affected.
  debian/carnil: |-
    For 4.9.y this has a separate backport, cf.
    https://lore.kernel.org/netdev/YnE%2FQ3SwZuG9HQNv@quatroqueijos/T/#t
    which is applied.
  masami: "There is no details. These patch series modified locking strategy \nthat\
    \ use Qdisc rcu API instead of rtnl lock.\nAll patches were merged at 4.20-rc1\
    \ in the mainline."
introduced-by:
  mainline: [32a4f5ecd7381f30ae3bb36dea77a150ba68af2e]
fixed-by:
  cip/4.19: [ae214e04b95ff64a4b0e9aab6742520bfde6ff0c, da1d324088c40fa0a382224c466175fc5c704106,
    f602ed9f8574512e7ea1ab65c3db7ba71053bf27, 92833e8b5db6c209e9311ac8c6a44d3bf1856659,
    cd25f1099284a0cbe916344fc1e6c1ffed6c5306]
  cip/4.19-rt: [ae214e04b95ff64a4b0e9aab6742520bfde6ff0c, da1d324088c40fa0a382224c466175fc5c704106,
    f602ed9f8574512e7ea1ab65c3db7ba71053bf27, 92833e8b5db6c209e9311ac8c6a44d3bf1856659,
    cd25f1099284a0cbe916344fc1e6c1ffed6c5306]
  debian/buster-security: ['version:debian/4.19.232-1']
  debian/stretch-security: ['version:debian/4.9.320-2']
  mainline: [e368fdb61d8e7c67ac70791b23345b26d7bbc661, 9d7e82cec35c027756ec97e274f878251f271181,
    3a7d0d07a386716b459b00783b11a8211cefcc0f, 86bd446b5cebd783187ea3772ff258210de77d99,
    6f99528e9797794b91b43321fbbc93fe772b0803]
  stable/4.19: [ae214e04b95ff64a4b0e9aab6742520bfde6ff0c, da1d324088c40fa0a382224c466175fc5c704106,
    f602ed9f8574512e7ea1ab65c3db7ba71053bf27, 92833e8b5db6c209e9311ac8c6a44d3bf1856659,
    cd25f1099284a0cbe916344fc1e6c1ffed6c5306]
  stable/4.9: [2b29404f4eea7da878a8a8c5b301d9adf6f56d55]
  ubuntu/bionic: ['version:4.15.0-10.11']
  ubuntu/focal: ['version:5.4.0-9.12']
