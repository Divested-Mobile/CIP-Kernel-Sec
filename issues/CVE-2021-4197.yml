description: 'cgroup: Use open-time creds and namespace for migration perm checks'
references:
- https://lore.kernel.org/lkml/20211209214707.805617-1-tj@kernel.org/T/
- https://bugzilla.redhat.com/show_bug.cgi?id=2035652
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4197
- https://ubuntu.com/security/notices/USN-5278-1
- https://ubuntu.com/security/notices/USN-5337-1
- https://ubuntu.com/security/notices/USN-5368-1
- https://ubuntu.com/security/notices/USN-5467-1
comments:
  debian/bwh: At least the first commit is applicable to all branches.
  debian/carnil: Fixed as well in 5.15.14 for 5.15.y.
  masami: |-
    commit 1756d79 fixed commit 187fe84 ("cgroup: require write perm on common
    ancestor when moving processes on the default hierarchy") that was merged in 4.2-rc1 and
    commit e574576 fixd commit 5136f63 ("cgroup: implement "nsdelegate" mount option") that
    was merged in 4.13-rc1.
    Commit 1756d79 ("cgroup: Use open-time credentials for process migraton perm checks") was
    failed to apply to 4.4, 4.9, 4.14, 4.19, 5.4, and 5.10.
    Commit 0d2b595 ("cgroup: Allocate cgroup_file_ctx for kernfs_open_file->priv") was failed
    to apply to 4.14, 4.19, 5.4, and 5.10.
    Commit e574576 ("cgroup: Use open-time cgroup namespace for process migration perm checks")
    was failed to apply 4.14, 4.19, 5.4, 5.10.
reporters:
- Eric W. Biederman
- Eric Biederman
fixed-by:
  cip/4.19: [0bd407959f7d6671ba0617e2dbda3e89d8a0419f, de37e01dd20e3228b010fe5fbd3e205747481b96,
    74ac12c718e7d3f7eb346ee90a4c9904a8b6b6d2]
  cip/4.19-rt: [0bd407959f7d6671ba0617e2dbda3e89d8a0419f, de37e01dd20e3228b010fe5fbd3e205747481b96,
    74ac12c718e7d3f7eb346ee90a4c9904a8b6b6d2]
  cip/5.10: [4665722d36ad13c6abc6b2ef3fe5150c0a92d870, f28364fe384feffbe7d44b095ef4571285465c47,
    824a950c3f1118eb06b1877c49ed1b2eca8e236d]
  mainline: [1756d7994ad85c2479af6ae5a9750b92324685af, 0d2b5955b36250a9428c832664f2079cbf723bec,
    e57457641613fef0d147ede8bd6a3047df588b95]
  stable/4.14: [a70bcf9ed08f3628a9324f054b0e041697b26853, f1ce7855afe6310f8cd9a472f6d52c872feb578b,
    2337c8257cd2a4f01bef92288458483955605bd1]
  stable/4.19: [0bd407959f7d6671ba0617e2dbda3e89d8a0419f, de37e01dd20e3228b010fe5fbd3e205747481b96,
    74ac12c718e7d3f7eb346ee90a4c9904a8b6b6d2]
  stable/5.10: [f28364fe384feffbe7d44b095ef4571285465c47, 824a950c3f1118eb06b1877c49ed1b2eca8e236d,
    4665722d36ad13c6abc6b2ef3fe5150c0a92d870]
  stable/5.15: [c6ebc35298848accb5e50c37fdb2490cf4690c92, 50273128d640e8d21a13aec5f4bbce4802f17d7d,
    43fa0b3639c5fd48c96b19d645d0c7ff2327651a]
  stable/5.4: [691a0fd625e06c138f7662286a87ffba48773f34, 9bd1ced6466e71dcb08b24b59b8dd87bb2369d07,
    8a887060af61b451c46938149c426defe16add77]
  ubuntu/bionic: [734483f7d2be77e6d06b80300af7500356671dbd, f24fba0f2d2f00f4a5e1bdc3e8b9a9f6aa47eb36,
    aed9cf0ac9d5cfa6407e4be51d424d4cd5b7996c]
  ubuntu/focal: [36cc73fc95b61cc1d685e01ec8b498a798aa17b1, 0232c6262064bb9ae104f5ca9c87dc034351cc23,
    2c5d057d502f0daa8065ca8f7a1ac92640fce5d7]
