description: concurrency use-after-free between drm_setmaster_ioctl and drm_mode_getresources
references:
- https://www.openwall.com/lists/oss-security/2022/04/12/3
- https://bugzilla.redhat.com/show_bug.cgi?id=2071022
- https://bugzilla.suse.com/show_bug.cgi?id=1197914
- https://www.openwall.com/lists/oss-security/2022/04/12/4
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1280
- https://www.openwall.com/lists/oss-security/2022/04/13/1
- https://twitter.com/spendergrsec/status/1513866037791440896
- https://www.cve.org/CVERecord?id=CVE-2022-1280
comments:
  debian/bwh: |-
    I think most of these are fixing similar races even if some are not
    needed for the specific race in the description.  I don't think it
    makes any sense to backport them selectively.
  debian/carnil: |-
    Not a problem on 5.15.y and newer, but the list of commits need
    to be isolated yet.
    Is the main fix 56f0729a510f ("drm: protect drm_master pointers
    in drm_lease.c")? Situation though is not very clear and what
    exactly is needed.
  masami: |-
    The reporter found this bug in 4.19.237. Kernel 5.15 and newer are already
    fixed (https://www.openwall.com/lists/oss-security/2022/04/12/4) but not described
    which commit(s) fixes this bug. According to the PoC
    (https://www.openwall.com/lists/oss-security/2022/04/12/3),
    it needs to open /dev/dri/card0. However, /dev/dri/card0's permission is following.
    crw-rw----+ 1 root video 226, 0 Apr 13 09:15 /dev/dri/card0 So, attacker must
    have correct privilege to abuse this CVE.
    The commit 1f7ef07 was reverted in 5.10
    (https://lore.kernel.org/stable/20210628142607.32218-97-sashal@kernel.org/).
    Searching in lore.kernel.org, the commit 869e76f looks as if it isn't
    backported to stable kernels.
    Searching in lore.kernel.org, the commit 28be240 looks as if it isn't
    backported to stable kernels.
fixed-by:
  cip/4.19: [7d233ba700ceb593905ea82b42dadb4ec8ef85e9, a376f7e66b654cb290fa9d16d8dab5bfef744463]
  cip/4.19-rt: [7d233ba700ceb593905ea82b42dadb4ec8ef85e9, a376f7e66b654cb290fa9d16d8dab5bfef744463]
  cip/5.10: [491d52e0078860b33b6c14f0a7ac74ca1b603bd6, aa8591a58cbd2986090709e4202881f18e8ae30e,
    54e51d288b38377e8cd645a83e1ad08cc9d20ccc, 06a553a99bacb00d3bc25f79e75c8e0fbf7a5025,
    34609faad0c9f9f08d4b59d25c94b78bf5710d93, d6c91423993e8164ca4162ff046c6437bbd75b53]
  cip/5.10-rt: [491d52e0078860b33b6c14f0a7ac74ca1b603bd6, aa8591a58cbd2986090709e4202881f18e8ae30e,
    54e51d288b38377e8cd645a83e1ad08cc9d20ccc, 06a553a99bacb00d3bc25f79e75c8e0fbf7a5025,
    34609faad0c9f9f08d4b59d25c94b78bf5710d93, d6c91423993e8164ca4162ff046c6437bbd75b53]
  mainline: [b436acd1cf7fac0ba987abd22955d98025c80c2b, c336a5ee984708db4826ef9e47d184e638e29717,
    869e76f7a918f010bd4518d58886969b1f642a04, 5eff9585de220cdd131237f5665db5e6c6bdf590,
    1f7ef07cfa14fb8557d1f1b7a14c76926142a4fb, 0b0860a3cf5eccf183760b1177a1dcdb821b0b66,
    56f0729a510f92151682ff6c89f69724d5595d6e, 28be2405fb753927e18bc1a891617a430b2a0684,
    2bc5da528dd570c5ecabc107e6fbdbc55974276f]
  stable/4.19: [7d233ba700ceb593905ea82b42dadb4ec8ef85e9, a376f7e66b654cb290fa9d16d8dab5bfef744463]
  stable/4.9: [8e250a134c8fe2a945d10b421d0ccb54e85d8683]
  stable/5.10: [491d52e0078860b33b6c14f0a7ac74ca1b603bd6, aa8591a58cbd2986090709e4202881f18e8ae30e,
    54e51d288b38377e8cd645a83e1ad08cc9d20ccc, 06a553a99bacb00d3bc25f79e75c8e0fbf7a5025,
    34609faad0c9f9f08d4b59d25c94b78bf5710d93, d6c91423993e8164ca4162ff046c6437bbd75b53]
ignore:
  debian/stretch-security: EOL
