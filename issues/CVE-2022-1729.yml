description: 'perf: Fix sys_perf_event_open() race against self'
references:
- https://lore.kernel.org/all/20220520183806.GV2578@worktop.programming.kicks-ass.net/T/#u
- https://www.openwall.com/lists/oss-security/2022/05/20/2
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1729
- https://github.com/torvalds/linux/commit/3ac6487e584a1eb54071dbe1212e05b884136704
comments:
  debian/carnil: |-
    Issue rendered harmless for exploition due to
    kernel.perf_event_paranoid >= 3 setting.
  masami: |-
    Introduced by commit f63a8da ("perf: Fix event->ctx locking")
    that was merged in 4.0-rc1. This race condition bug allows a local
    user privilege escalation. To set kernel.perf_event_paranoid >= 3,
    effectively rendering the vulnerability harmless.
  ubuntu/amurray: |-
    Ubuntu kernels enable SECURITY_PERF_EVENTS_RESTRICT which sets
     kernel.perf_event_paranoid >= 3 and so disables unprivileged users from
     using perf by default. As such in their default configuration, Ubuntu
     kernels are not able to be exploited by this flaw to achieve local
     privilege escalation.
reporters:
- Norbert Slusarek
introduced-by:
  aosp/3.10: [0aa98a5d4f6db7254d50057db0ba7159e81c07da]
  aosp/3.18: [33b738f7c5a704b729b2502669cf71c7b25ab7d6]
  mainline: [f63a8daa5812afef4f06c962351687e1ff9ccb2b]
  stable/3.18: [33b738f7c5a704b729b2502669cf71c7b25ab7d6]
fixed-by:
  mainline: [3ac6487e584a1eb54071dbe1212e05b884136704]
