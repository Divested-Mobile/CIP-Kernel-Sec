description: 'perf: Fix sys_perf_event_open() race against self'
references:
- https://lore.kernel.org/all/20220520183806.GV2578@worktop.programming.kicks-ass.net/T/#u
- https://www.openwall.com/lists/oss-security/2022/05/20/2
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1729
- https://github.com/torvalds/linux/commit/3ac6487e584a1eb54071dbe1212e05b884136704
- https://www.openwall.com/lists/oss-security/2022/06/30/2
- https://ubuntu.com/security/notices/USN-5560-1
- https://ubuntu.com/security/notices/USN-5560-2
- https://ubuntu.com/security/notices/USN-5594-1
- https://ubuntu.com/security/notices/USN-5599-1
- https://ubuntu.com/security/notices/USN-5602-1
- https://ubuntu.com/security/notices/USN-5616-1
- https://ubuntu.com/security/notices/USN-5622-1
- https://ubuntu.com/security/notices/USN-5623-1
- https://ubuntu.com/security/notices/USN-5630-1
- https://ubuntu.com/security/notices/USN-5639-1
- https://ubuntu.com/security/notices/USN-5647-1
- https://ubuntu.com/security/notices/USN-5650-1
- https://ubuntu.com/security/notices/USN-5654-1
- https://ubuntu.com/security/notices/USN-5660-1
- https://www.cve.org/CVERecord?id=CVE-2022-1729
comments:
  debian/carnil: |-
    Issue rendered harmless for exploition due to
    kernel.perf_event_paranoid >= 3 setting.
    For 5.17.y fixed as well in 5.17.10.
  masami: |-
    Introduced by commit f63a8da ("perf: Fix event->ctx locking")
    that was merged in 4.0-rc1. This race condition bug allows a local
    user privilege escalation. To set kernel.perf_event_paranoid >= 3,
    effectively rendering the vulnerability harmless.
  ubuntu/alexmurray: |-
    Ubuntu kernels enable SECURITY_PERF_EVENTS_RESTRICT which sets
     kernel.perf_event_paranoid >= 3 and so disables unprivileged users from
     using perf by default. As such in their default configuration, Ubuntu
     kernels are not able to be exploited by this flaw to achieve local
     privilege escalation.
  ubuntu/amurray: |-
    Ubuntu kernels enable SECURITY_PERF_EVENTS_RESTRICT which sets
     kernel.perf_event_paranoid >= 3 and so disables unprivileged users from
     using perf by default. As such in their default configuration, Ubuntu
     kernels are not able to be exploited by this flaw to achieve local
     privilege escalation.
reporters:
- Norbert Slusarek
introduced-by:
  aosp/3.10: [0aa98a5d4f6db7254d50057db0ba7159e81c07da]
  aosp/3.18: [33b738f7c5a704b729b2502669cf71c7b25ab7d6]
  mainline: [f63a8daa5812afef4f06c962351687e1ff9ccb2b]
  stable/3.18: [33b738f7c5a704b729b2502669cf71c7b25ab7d6]
fixed-by:
  cip/4.19: [6cdd53a49aa7413e53c14ece27d826f0b628b18a]
  cip/4.19-rt: [6cdd53a49aa7413e53c14ece27d826f0b628b18a]
  cip/4.4: [81ed6530431521cba86d45bba4945e9eb80deb61]
  cip/4.4-rt: [81ed6530431521cba86d45bba4945e9eb80deb61]
  cip/4.4-st: [81ed6530431521cba86d45bba4945e9eb80deb61]
  cip/5.10: [3ee8e109c3c316073a3e0f83ec0769c7ee8a7375]
  cip/5.10-rt: [3ee8e109c3c316073a3e0f83ec0769c7ee8a7375]
  debian/buster-security: ['version:debian/4.19.249-1']
  debian/stretch-security: ['version:debian/4.9.320-2']
  mainline: [3ac6487e584a1eb54071dbe1212e05b884136704]
  openela/4.14: [dee63319e2d1abd5d37a89de046ccf32ca8a8451]
  stable/4.14: [dee63319e2d1abd5d37a89de046ccf32ca8a8451]
  stable/4.19: [6cdd53a49aa7413e53c14ece27d826f0b628b18a]
  stable/4.9: [a1466528d8ae5d9a3bb29781f0098fa3476e9e1c]
  stable/5.10: [3ee8e109c3c316073a3e0f83ec0769c7ee8a7375]
  stable/5.15: [e085354dde254bc6c83ee604ea66c2b36f9f9067]
  stable/5.17: [22fb2974224c9836eeaf0d24fdd481fcdaa0aea8]
  stable/5.4: [dd0ea88b0a0f913f82500e988ef38158a9ad9885]
  ubuntu/bionic: [e32e5af9d26061c066ed7fd6a21d1c2596c9b35f]
  ubuntu/focal: [77802fa2b8ac19f27b26aff2b2c0210df5e2688a]
