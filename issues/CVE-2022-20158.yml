description: 'mm: backing-dev: Take a reference to the bdi in use to prevent UAF'
references:
- https://source.android.com/security/bulletin/pixel/2022-08-01
- https://android.googlesource.com/kernel/common/+/69e8f03c5ced3e4e6fb4181f4dac185104e3420b
- https://android.googlesource.com/kernel/common/+/80d91b86a199798ee2321a0ab0f09e6e12764678
- https://android-review.googlesource.com/c/kernel/common/+/1926004
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-20158
- https://lore.kernel.org/all/20211021124441.668816-4-hch@lst.de/T/#u
comments:
  debian/carnil: |-
    The second commit is 0b3ea0926afb ("fs: explicitly unregister
    per-superblock BDIs") in 5.16-rc1.
    Is this an Android specific issue? 5.16-rc1 contains as well
    702f2d1e3b33 ("mm: don't automatically unregister bdis") as
    "All BDI users now unregister explicitly" at that point.
  masami: "The first commit 69e8f03(\"mm: backing-dev: Take a reference to\nthe bdi\
    \ in use to prevent UAF\") is not present in the mainline\nand stable kernels.\
    \ \nCommit 80d91b8 was merged in 5.16-rc1(commit hash is\n0b3ea0926afb8dde70cfab00316ae0a70b93a7cc)\
    \ which requires commit\nc6fd3ac (\"mm: export bdi_unregister\") that exports\
    \ symbol of\nbdi_unregister(). "
fixed-by:
  mainline: [0b3ea0926afb8dde70cfab00316ae0a70b93a7cc]
