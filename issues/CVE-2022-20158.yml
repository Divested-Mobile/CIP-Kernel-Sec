description: 'mm: backing-dev: Take a reference to the bdi in use to prevent UAF'
references:
- https://source.android.com/security/bulletin/pixel/2022-08-01
- https://android.googlesource.com/kernel/common/+/69e8f03c5ced3e4e6fb4181f4dac185104e3420b
- https://android.googlesource.com/kernel/common/+/80d91b86a199798ee2321a0ab0f09e6e12764678
- https://android-review.googlesource.com/c/kernel/common/+/1926004
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-20158
- https://lore.kernel.org/all/20211021124441.668816-4-hch@lst.de/T/#u
- https://android.googlesource.com/kernel/common/+/a0046956bf6fe
- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c700525fcc06b05adfea78039de02628af79e07a
- https://lore.kernel.org/all/420a6c4a-e526-4e8b-d5bd-563c40aa94e1@huaweicloud.com/
- https://lore.kernel.org/all/YvYAmmaJgvydex4p@google.com/
- https://www.cve.org/CVERecord?id=CVE-2022-20158
comments:
  debian/carnil: |-
    The second commit is 0b3ea0926afb ("fs: explicitly unregister
    per-superblock BDIs") in 5.16-rc1.
    Is this an Android specific issue? 5.16-rc1 contains as well
    702f2d1e3b33 ("mm: don't automatically unregister bdis") as
    "All BDI users now unregister explicitly" at that point.
    Lee Jones clarified that the issue is specific to Android
    released kernel versions which had an internal, device specific
    commit, causing the issue. This does not affect upstream or
    stable kernels accordingly.
  masami: "The first commit 69e8f03(\"mm: backing-dev: Take a reference to\nthe bdi\
    \ in use to prevent UAF\") is not present in the mainline\nand stable kernels.\
    \ \nCommit 80d91b8 was merged in 5.16-rc1(commit hash is\n0b3ea0926afb8dde70cfab00316ae0a70b93a7cc)\
    \ which requires commit\nc6fd3ac (\"mm: export bdi_unregister\") that exports\
    \ symbol of\nbdi_unregister(). "
  ubuntu/alexmurray: Seems to be the same as CVE-2022-20368
  ubuntu/amurray: Seems to be the same as CVE-2022-20368
  ubuntu/sbeattie: |-
    It seems the android advisory that contains this CVE has been
      updated to correctly reflect the associated commits with this issue;
      furthermore, it appears to have been introduced with an android only
      commit (see lore reference).
introduced-by:
  mainline: [0fb375fb9b93b7d822debc6a734052337ccfdb1f]
fixed-by:
  mainline: [0b3ea0926afb8dde70cfab00316ae0a70b93a7cc]
