description: A buffer overflow bug was found in nfsd
references:
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-43945
- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f90497a16e434c2211c66e3de8e77b17868382b8
- https://lore.kernel.org/linux-nfs/B00F6DD5-8215-457B-A681-39D7A64B7668@oracle.com/
- https://ubuntu.com/security/notices/USN-5754-1
- https://ubuntu.com/security/notices/USN-5755-1
- https://ubuntu.com/security/notices/USN-5755-2
- https://ubuntu.com/security/notices/USN-5754-2
- https://ubuntu.com/security/notices/USN-5773-1
- https://ubuntu.com/security/notices/USN-5779-1
- https://ubuntu.com/security/notices/USN-5789-1
- https://ubuntu.com/security/notices/USN-5794-1
- https://ubuntu.com/security/notices/USN-5802-1
- https://ubuntu.com/security/notices/USN-5804-1
- https://ubuntu.com/security/notices/USN-5804-2
- https://ubuntu.com/security/notices/USN-5808-1
- https://ubuntu.com/security/notices/USN-5813-1
- https://lore.kernel.org/linux-nfs/Y8vyFuQ0UdiiEJRw@eldamar.lan/T/#t
- https://ubuntu.com/security/notices/USN-5829-1
- https://ubuntu.com/security/notices/USN-5830-1
- https://ubuntu.com/security/notices/USN-5861-1
- https://ubuntu.com/security/notices/USN-5863-1
- https://ubuntu.com/security/notices/USN-5875-1
- https://ubuntu.com/security/notices/USN-5914-1
- https://ubuntu.com/security/notices/USN-5918-1
- https://www.cve.org/CVERecord?id=CVE-2022-43945
comments:
  debian/bwh: |-
    The affected code was changed in 5.12, 5.13, and 5.15.
    It's not yet clear to me whether earlier versions are also
    affected.
  debian/carnil: Fixed in 5.19.17 for 5.19.y and in 6.0.3 for 6.0.y.
  debian/jmm: Per Neil Brown's comment at https://bugzilla.suse.com/show_bug.cgi?id=1205128#c4
    older kernels are also affected
  masami: |-
    nfsd3_proc_read() and nfsd_proc_read() changed to set argp->count value adding extra min_t() macro.
      nfsd_init_dirlist_pages() and nfsd3_init_dirlist_pages() changed process of setting buf->buflen value.
      However, 4.4, 4.19, 5.10 uses different way to set these values. So, even if these kernels are vulnerable, it needs different way to fix.
    According to the commit ("NFSD: Protect against send buffer overflow in NFSv2 READDIR"), its fixes tag
      that point to commit 53b1119 ("NFSD: Fix READDIR buffer overflow").
    This commit fixes f5dcccd ("NFSD: Update the NFSv2 READDIR entry encoder to use struct xdr_stream")
      and 7f87fc2 ("NFSD: Update NFSv3 READDIR entry encoders to use struct xdr_stream").
    Both commits were merged in 5.13-rc1. So, if root cause is 7f87fc2, less than 5.15 kernels may not be affected by this issue.
fixed-by:
  mainline: [00b4492686e0497fdb924a9d4c8f6f99377e176c, 640f87c190e0d1b2a0fcb2ecf6d2cd53b1c41991,
    401bc1f90874280a80b93f23be33a0e7e2d1f912, fa6be9cc6e80ec79892ddf08a8c10cabab9baf38]
  stable/5.15: [dc7f225090c29a5f3b9419b1af32846a201555e7, 071a076fd1b763aa6fe478efa047e0a549ba9c22,
    2be9331ca6061bc6ea32247266f45b8b21030244, 75d9de25a6f833dd0701ca546ac926cabff2b5af]
  stable/6.0: [f59c74df82f6ac9d2ea4e01aa3ae7c6c4481652d, 279274e31270c28b86feffe5e166d4088f22317b,
    1868332032eccbab8c1878a0d918193058c0a905, 309f29361b6bfae96936317376f1114568c5de19]
  ubuntu/bionic: [fabe1dafea38d54ee7a1e0390c5895e889e29a1d]
  ubuntu/focal: [d5f2c4153a312ea4bd2aec6e3bc5dce6f29d3ca9]
