description: possibility of deadlock in libbpf function sock_hash_delete_elem
references:
- https://bugzilla.redhat.com/show_bug.cgi?id=2159764
- https://lore.kernel.org/lkml/CABcoxUayum5oOqFMMqAeWuS8+EzojquSOSyDA3J_2omY=2EeAg@mail.gmail.com/
- https://lore.kernel.org/all/63dddcc92fc31_6bb15208e9@john.notmuch/
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-0160
- https://lore.kernel.org/all/CABcoxUayum5oOqFMMqAeWuS8+EzojquSOSyDA3J_2omY=2EeAg@mail.gmail.com/
- https://bugzilla.suse.com/show_bug.cgi?id=1209657
- https://lore.kernel.org/netdev/87a614h62a.fsf@cloudflare.com/t/#u
- https://lore.kernel.org/all/20230406122622.109978-1-liuxin350@huawei.com/
- https://lore.kernel.org/bpf/000000000000f1db9605f939720e@google.com/
- https://www.cve.org/CVERecord?id=CVE-2023-0160
comments:
  debian/carnil: |-
    As noted by Ubuntu: first attempt to fix was reverted in
    8c5c2a4898e3 ("bpf, sockmap: Revert buggy deadlock fix in the
    sockhash and sockmap")
  masami: "Introduced by commit 604326b (\"bpf, sockmap: convert to generic\nsk_msg\
    \ interface\") in 4.20-rc1. So 4.x are not affected. "
  ubuntu/sbeattie: |-
    first attempt to fix was reverted in 8c5c2a4898e3 ("bpf,
      sockmap: Revert buggy deadlock fix in the sockhash and sockmap")
    unfixed upstream as of 2023.06.14
reporters:
- Hsin-Wei Hung
introduced-by:
  mainline: [604326b41a6fb9b4a78b6179335decee0365cd8c]
fixed-by:
  cip/5.10: [2f9307222227410453e33654f5d9ed6459351455]
  cip/5.10-rt: [2f9307222227410453e33654f5d9ed6459351455]
  cip/6.1: [1d4ac7b0ffc9dc683b8dafc78b8b93177071a02c]
  cip/6.1-rt: [1d4ac7b0ffc9dc683b8dafc78b8b93177071a02c]
  mainline: [ed17aa92dc56b6d8883e4b7a8f1c6fbf5ed6cd29]
  stable/5.10: [2f9307222227410453e33654f5d9ed6459351455]
  stable/5.15: [f333854dce4a079783f00c201869b9ee8f7ff3c3]
  stable/5.4: [c229821510dfe35e89899b00ec34f9f5876fbbd2]
  stable/6.1: [1d4ac7b0ffc9dc683b8dafc78b8b93177071a02c]
  ubuntu/focal: [31d620e98d3d3714dca35b1e421d27c1125b3b4c]
