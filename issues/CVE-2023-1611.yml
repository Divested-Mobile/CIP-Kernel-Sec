description: 'Kernel: race between quota disable and quota assign ioctls in fs/btrfs/ioctl.c'
references:
- https://bugzilla.redhat.com/show_bug.cgi?id=2181342
- https://lore.kernel.org/linux-btrfs/35b9a70650ea947387cf352914a8774b4f7e8a6f.1679481128.git.fdmanana@suse.com/
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-1611
- https://git.kernel.org/pub/scm/linux/kernel/git/kdave/linux.git/commit/?h=next-fixes&id=2f1a6be12ab6c8470d5776e68644726c94257c54
- https://bugzilla.suse.com/show_bug.cgi?id=1209687
- https://ubuntu.com/security/notices/USN-6175-1
- https://ubuntu.com/security/notices/USN-6186-1
- https://ubuntu.com/security/notices/USN-6252-1
- https://ubuntu.com/security/notices/USN-6254-1
- https://ubuntu.com/security/notices/USN-6284-1
- https://ubuntu.com/security/notices/USN-6300-1
- https://ubuntu.com/security/notices/USN-6301-1
- https://ubuntu.com/security/notices/USN-6311-1
- https://ubuntu.com/security/notices/USN-6312-1
- https://ubuntu.com/security/notices/USN-6314-1
- https://ubuntu.com/security/notices/USN-6331-1
- https://ubuntu.com/security/notices/USN-6332-1
- https://ubuntu.com/security/notices/USN-6337-1
- https://ubuntu.com/security/notices/USN-6347-1
- https://ubuntu.com/security/notices/USN-6385-1
comments:
  debian/bwh: |-
    It looks like this was introduced in 5.17 by commit 232796df8c14
    "btrfs: fix deadlock between quota enable and other quota
    operations" which was then backported into 5.10.94.  This
    issue doesn't currently affect 4.19, but will do if that earlier
    fix is picked alone.
  masami: |-
    Introduced by commit e082f56 ("btrfs: quota: Update quota
    tree after qgroup relationship change.") in 4.1-rc1.
  ubuntu/cascardo: requires CAP_SYS_ADMIN capability in the initial user namespace
  ubuntu/sbeattie: |-
    possibly requires admin privileges to trigger quota disable
      ioctl needed to exploit
reporters:
- butt3rflyh4ck
introduced-by:
  mainline: [e082f56313f374d723b0366978ddb062c8fe79ea]
fixed-by:
  cip/5.10: [5f6347034341bf45056ca1ec3fa72040152ecf83]
  cip/5.10-rt: [5f6347034341bf45056ca1ec3fa72040152ecf83]
  cip/6.1: [a38ff2024805a30d9b96f52557c6ea0bbc31252a]
  cip/6.1-rt: [a38ff2024805a30d9b96f52557c6ea0bbc31252a]
  mainline: [2f1a6be12ab6c8470d5776e68644726c94257c54]
  stable/5.10: [5f6347034341bf45056ca1ec3fa72040152ecf83]
  stable/5.15: [c976f9233ef926e090db5614a837824a0bcab3fb]
  stable/5.4: [0e0f324c259d87639bda61a0bdea9c32c4aecdc6]
  stable/6.1: [a38ff2024805a30d9b96f52557c6ea0bbc31252a]
  stable/6.2: [4caab245b0469ce9258ba099a41e909f5d307b33]
  ubuntu/focal: [b418f6b509fdeb63047e1c35303f165a28eb32d9]
