description: 'sock_map: avoid race between sock_map_close and sk_psock_put'
references:
- https://www.cve.org/CVERecord?id=CVE-2024-39500
- https://git.kernel.org/stable/c/4959ffc65a0e94f8acaac20deac49f89e6ded52d
- https://git.kernel.org/stable/c/5eabdf17fed2ad41b836bb4055ec36d95e512c50
- https://git.kernel.org/stable/c/e946428439a0d2079959f5603256ac51b6047017
- https://git.kernel.org/stable/c/3627605de498639a3c586c8684d12c89cba11073
- https://git.kernel.org/stable/c/4b4647add7d3c8530493f7247d11e257ee425bf0
- https://lore.kernel.org/linux-cve-announce/2024071203-CVE-2024-39500-eba6@gregkh/
- https://git.kernel.org/linus/4b4647add7d3c8530493f7247d11e257ee425bf0
- https://ubuntu.com/security/notices/USN-6999-1
- https://ubuntu.com/security/notices/USN-7004-1
- https://ubuntu.com/security/notices/USN-7005-1
- https://ubuntu.com/security/notices/USN-7007-1
- https://ubuntu.com/security/notices/USN-7008-1
- https://ubuntu.com/security/notices/USN-7005-2
- https://ubuntu.com/security/notices/USN-7009-1
- https://ubuntu.com/security/notices/USN-7019-1
comments:
  cip/cip-kernel-sec: |-
    Introduced by commit aadb2bb ("sock_map: Fix a potential use-after-free in sock_map_close()") in v5.13-rc1.
    Introduced by commit 5b4a79b ("bpf, sockmap: Don't let sock_map_{close,destroy,unhash} call itself") in v6.2-rc7.
    Fixed in v6.10-rc2.
  debian/carnil: |-
    Introduced in aadb2bb83ff7 ("sock_map: Fix a potential use-after-free in
    sock_map_close()")
    5b4a79ba65a1 ("bpf, sockmap: Don't let sock_map_{close,destroy,unhash} call
    itself"). Vulnerable versions: 5.13-rc1.
introduced-by:
  cip/6.1: [aadb2bb83ff789de63b48b4edeab7329423a50d3, 7499859881488da97589f3c79cc66fa75748ad49]
  cip/6.1-rt: [aadb2bb83ff789de63b48b4edeab7329423a50d3, 7499859881488da97589f3c79cc66fa75748ad49]
  mainline: [aadb2bb83ff789de63b48b4edeab7329423a50d3, 5b4a79ba65a1ab479903fff2e604865d229b70a9]
  stable/5.15: [aadb2bb83ff789de63b48b4edeab7329423a50d3, f312367f5246e04df564d341044286e9e37a97ba]
  stable/6.1: [aadb2bb83ff789de63b48b4edeab7329423a50d3, 7499859881488da97589f3c79cc66fa75748ad49]
fixed-by:
  cip/6.1: [5eabdf17fed2ad41b836bb4055ec36d95e512c50]
  cip/6.1-rt: [5eabdf17fed2ad41b836bb4055ec36d95e512c50]
  mainline: [4b4647add7d3c8530493f7247d11e257ee425bf0]
  stable/5.15: [4959ffc65a0e94f8acaac20deac49f89e6ded52d]
  stable/6.1: [5eabdf17fed2ad41b836bb4055ec36d95e512c50]
  stable/6.6: [e946428439a0d2079959f5603256ac51b6047017]
  stable/6.9: [3627605de498639a3c586c8684d12c89cba11073]
