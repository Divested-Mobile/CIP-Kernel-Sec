description: "In the Linux kernel, the following vulnerability has been resolved:\n\
  ice: Add netif_device_attach/detach into PF reset flow\nEthtool callbacks can be\
  \ executed while reset is in progress and try to\naccess deleted resources, e.g.\
  \ getting coalesce settings can result in a\nNULL pointer dereference seen below.\n\
  Reproduction steps:\nOnce the driver is fully initialized, trigger reset:\n\t# echo\
  \ 1 > /sys/class/net/<interface>/device/reset\nwhen reset is in progress try to\
  \ get coalesce settings using ethtool:\n\t# ethtool -c <interface>\nBUG: kernel\
  \ NULL pointer dereference, address: 0000000000000020\nPGD 0 P4D 0\nOops: Oops:\
  \ 0000 [#1] PREEMPT SMP PTI\nCPU: 11 PID: 19713 Comm: ethtool Tainted: G S     \
  \            6.10.0-rc7+\n#7\nRIP: 0010:ice_get_q_coalesce+0x2e/0xa0 [ice]\nRSP:\
  \ 0018:ffffbab1e9bcf6a8 EFLAGS: 00010206\nRAX: 000000000000000c RBX: ffff94512305b028\
  \ RCX: 0000000000000000\nRDX: 0000000000000000 RSI: ffff9451c3f2e588 RDI: ffff9451c3f2e588\n\
  RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000\nR10: ffff9451c3f2e580\
  \ R11: 000000000000001f R12: ffff945121fa9000\nR13: ffffbab1e9bcf760 R14: 0000000000000013\
  \ R15: ffffffff9e65dd40\nFS:  00007faee5fbe740(0000) GS:ffff94546fd80000(0000)\n\
  knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2:\
  \ 0000000000000020 CR3: 0000000106c2e005 CR4: 00000000001706f0\nCall Trace:\n<TASK>\n\
  ice_get_coalesce+0x17/0x30 [ice]\ncoalesce_prepare_data+0x61/0x80\nethnl_default_doit+0xde/0x340\n\
  genl_family_rcv_msg_doit+0xf2/0x150\ngenl_rcv_msg+0x1b3/0x2c0\nnetlink_rcv_skb+0x5b/0x110\n\
  genl_rcv+0x28/0x40\nnetlink_unicast+0x19c/0x290\nnetlink_sendmsg+0x222/0x490\n__sys_sendto+0x1df/0x1f0\n\
  __x64_sys_sendto+0x24/0x30\ndo_syscall_64+0x82/0x160\nentry_SYSCALL_64_after_hwframe+0x76/0x7e\n\
  RIP: 0033:0x7faee60d8e27\nCalling netif_device_detach() before reset makes the net\
  \ core not call\nthe driver when ethtool command is issued, the attempt to execute\
  \ an\nethtool command during reset will result in the following message:\n    netlink\
  \ error: No such device\ninstead of NULL pointer dereference. Once reset is done\
  \ and\nice_rebuild() is executing, the netif_device_attach() is called to allow\n\
  for ethtool operations to occur again in a safe manner."
references:
- https://www.cve.org/CVERecord?id=CVE-2024-46770
- https://git.kernel.org/linus/d11a67634227f9f9da51938af085fb41a733848f
- https://git.kernel.org/stable/c/9e3ffb839249eca113062587659224f856fe14e5
- https://git.kernel.org/stable/c/efe8effe138044a4747d1112ebb8c454d1663723
- https://git.kernel.org/stable/c/36486c9e8e01b84faaee47203eac0b7e9cc7fa4a
- https://git.kernel.org/stable/c/d11a67634227f9f9da51938af085fb41a733848f
introduced-by:
  mainline: [fcea6f3da546b93050f3534aadea7bd96c1d7349]
fixed-by:
  mainline: [d11a67634227f9f9da51938af085fb41a733848f]
