#!/bin/sh -eu

. "$(dirname "$0")/common.sh"
. "$(dirname "$0")/bobfuzzer.sh"

assert_kconfig CONFIG_BTRFS_FS
assert_kconfig CONFIG_KASAN

bobfuzzer_mount_and_run CVE-2019-19039 btrfs

# We still expect a warning, but not from KASAN
assert_untainted 0x200
! (dmesg | grep 'BUG: KASAN:')
